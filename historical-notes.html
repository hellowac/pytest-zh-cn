<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="search.html" />
        <link rel="canonical" href="https://docs.pytest.org/en/stable/historical-notes.html" />

    <link rel="shortcut icon" href="_static/favicon.png"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Historical Notes - pytest documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/pygments_pytest.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/pytest-custom.css?v=eb7c59a4" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">pytest documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/pytest1.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">入门</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="how-to/index.html">操作指南</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 操作指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="how-to/usage.html">如何调用 pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/assert.html">如何在测试中编写和报告断言</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/fixtures.html">如何使用 fixture</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/mark.html">如何用属性标记测试函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/parametrize.html">如何参数化fixtures和测试函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/tmp_path.html">如何在测试中使用临时目录和文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/monkeypatch.html">如何使用 猴子补丁/mock 模块和环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/doctest.html">如何运行文档测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/cache.html">如何重新运行失败的测试并在测试运行之间保持状态</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/failures.html">如何处理测试失败</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/output.html">管理 pytest 的输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/logging.html">如何管理日志记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/capture-stdout-stderr.html">如何捕获 stdout/stderr 输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/capture-warnings.html">如何捕获警告</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/skipping.html">如何使用 skip 和 xfail 处理无法成功的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/plugins.html">如何安装和使用插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/writing_plugins.html">编写插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/writing_hook_functions.html">编写钩子函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/existingtestsuite.html">如何将 pytest 与现有测试套件结合使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/unittest.html">如何在 pytest 中使用基于 unittest 的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/xunit_setup.html">如何实现 xunit 样式的设置</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-to/bash-completion.html">如何设置 bash 补全</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference/index.html">参考指南</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 参考指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/reference.html">API 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/fixtures.html">Fixtures 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/customize.html">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/exit-codes.html">退出码</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/plugin_list.html">Pytest 插件列表</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="explanation/index.html">解答</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 解答</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="explanation/anatomy.html">测试剖析</a></li>
<li class="toctree-l2"><a class="reference internal" href="explanation/fixtures.html">关于 fixtures</a></li>
<li class="toctree-l2"><a class="reference internal" href="explanation/goodpractices.html">良好的集成实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="explanation/pythonpath.html">pytest 导入机制和 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> / <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="explanation/ci.html">CI Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="explanation/flaky.html">不稳定的测试</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="example/index.html">示例和自定义技巧</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 示例和自定义技巧</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="example/reportingdemo.html">使用 pytest 的 Python 故障报告演示</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/simple.html">基本模式和示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/parametrize.html">参数化测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/markers.html">使用自定义标记</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/special.html">可以查看所有收集到的测试的会话fixture</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/pythoncollection.html">改变标准 (Python) 测试的发现机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/nonpython.html">使用非 Python 测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="example/customdirectory.html">使用自定义目录收集器</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">关于项目</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">更改日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="backwards-compatibility.html">向后兼容政策</a></li>
<li class="toctree-l1"><a class="reference internal" href="backwards-compatibility.html#id2">历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="backwards-compatibility.html#python">Python版本支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="sponsor.html">赞助</a></li>
<li class="toctree-l1"><a class="reference internal" href="tidelift.html">pytest 企业版</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">许可</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">联系渠道</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">游泳的链接</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/pytest/">pytest @ PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytest-dev/pytest/">pytest @ GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytest-dev/pytest/issues">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://media.readthedocs.org/pdf/pytest/latest/pytest.pdf">PDF Documentation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="historical-notes">
<h1>Historical Notes<a class="headerlink" href="#historical-notes" title="Link to this heading">¶</a></h1>
<p>This page lists features or behavior from previous versions of pytest which have changed over the years. They are
kept here as a historical note so users looking at old code can find documentation related to them.</p>
<section id="marker-revamp-and-iteration">
<span id="marker-revamp"></span><h2>Marker revamp and iteration<a class="headerlink" href="#marker-revamp-and-iteration" title="Link to this heading">¶</a></h2>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.6.</span></p>
</div>
<p>pytest’s marker implementation traditionally worked by simply updating the <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> attribute of functions to cumulatively add markers. As a result, markers would unintentionally be passed along class hierarchies in surprising ways. Further, the API for retrieving them was inconsistent, as markers from parameterization would be stored differently than markers applied using the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark</span></code> decorator and markers added via <code class="docutils literal notranslate"><span class="pre">node.add_marker</span></code>.</p>
<p>This state of things made it technically next to impossible to use data from markers correctly without having a deep understanding of the internals, leading to subtle and hard to understand bugs in more advanced usages.</p>
<p>Depending on how a marker got declared/changed one would get either a <code class="docutils literal notranslate"><span class="pre">MarkerInfo</span></code> which might contain markers from sibling classes,
<code class="docutils literal notranslate"><span class="pre">MarkDecorators</span></code> when marks came from parameterization or from a <code class="docutils literal notranslate"><span class="pre">node.add_marker</span></code> call, discarding prior marks. Also <code class="docutils literal notranslate"><span class="pre">MarkerInfo</span></code> acts like a single mark, when it in fact represents a merged view on multiple marks with the same name.</p>
<p>On top of that markers were not accessible in the same way for modules, classes, and functions/methods.
In fact, markers were only accessible in functions, even if they were declared on classes/modules.</p>
<p>A new API to access markers has been introduced in pytest 3.6 in order to solve the problems with
the initial design, providing the <a class="reference internal" href="reference/reference.html#pytest.nodes.Node.iter_markers" title="_pytest.nodes.Node.iter_markers"><code class="xref py py-func docutils literal notranslate"><span class="pre">_pytest.nodes.Node.iter_markers()</span></code></a> method to iterate over
markers in a consistent manner and reworking the internals, which solved a great deal of problems
with the initial design.</p>
<section id="updating-code">
<span id="update-marker-code"></span><h3>Updating code<a class="headerlink" href="#updating-code" title="Link to this heading">¶</a></h3>
<p>The old <code class="docutils literal notranslate"><span class="pre">Node.get_marker(name)</span></code> function is considered deprecated because it returns an internal <code class="docutils literal notranslate"><span class="pre">MarkerInfo</span></code> object
which contains the merged name, <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> of all the markers which apply to that node.</p>
<p>In general there are two scenarios on how markers should be handled:</p>
<p>1. Marks overwrite each other. Order matters but you only want to think of your mark as a single item. E.g.
<code class="docutils literal notranslate"><span class="pre">log_level('info')</span></code> at a module level can be overwritten by <code class="docutils literal notranslate"><span class="pre">log_level('debug')</span></code> for a specific test.</p>
<blockquote>
<div><p>In this case, use <code class="docutils literal notranslate"><span class="pre">Node.get_closest_marker(name)</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace this:</span>
<span class="n">marker</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_marker</span><span class="p">(</span><span class="s2">&quot;log_level&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">marker</span><span class="p">:</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># by this:</span>
<span class="n">marker</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_closest_marker</span><span class="p">(</span><span class="s2">&quot;log_level&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">marker</span><span class="p">:</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>2. Marks compose in an additive manner. E.g. <code class="docutils literal notranslate"><span class="pre">skipif(condition)</span></code> marks mean you just want to evaluate all of them,
order doesn’t even matter. You probably want to think of your marks as a set here.</p>
<blockquote>
<div><p>In this case iterate over each mark and handle their <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> individually.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace this</span>
<span class="n">skipif</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_marker</span><span class="p">(</span><span class="s2">&quot;skipif&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">skipif</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">skipif</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
        <span class="c1"># eval condition</span>
        <span class="o">...</span>

<span class="c1"># by this:</span>
<span class="k">for</span> <span class="n">skipif</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">iter_markers</span><span class="p">(</span><span class="s2">&quot;skipif&quot;</span><span class="p">):</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="n">skipif</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># eval condition</span>
</pre></div>
</div>
</div></blockquote>
<p>If you are unsure or have any questions, please consider opening
<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/new">an issue</a>.</p>
</section>
<section id="related-issues">
<h3>Related issues<a class="headerlink" href="#related-issues" title="Link to this heading">¶</a></h3>
<p>Here is a non-exhaustive list of issues fixed by the new implementation:</p>
<ul class="simple">
<li><p>Marks don’t pick up nested classes (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/199">#199</a>).</p></li>
<li><p>Markers stain on all related classes (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/568">#568</a>).</p></li>
<li><p>Combining marks - args and kwargs calculation (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/2897">#2897</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">request.node.get_marker('name')</span></code> returns <code class="docutils literal notranslate"><span class="pre">None</span></code> for markers applied in classes (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/902">#902</a>).</p></li>
<li><p>Marks applied in parametrize are stored as markdecorator (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/2400">#2400</a>).</p></li>
<li><p>Fix marker interaction in a backward incompatible way (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/1670">#1670</a>).</p></li>
<li><p>Refactor marks to get rid of the current “marks transfer” mechanism (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/2363">#2363</a>).</p></li>
<li><p>Introduce FunctionDefinition node, use it in generate_tests (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/2522">#2522</a>).</p></li>
<li><p>Remove named marker attributes and collect markers in items (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/891">#891</a>).</p></li>
<li><p>skipif mark from parametrize hides module level skipif mark (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/1540">#1540</a>).</p></li>
<li><p>skipif + parametrize not skipping tests (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/1296">#1296</a>).</p></li>
<li><p>Marker transfer incompatible with inheritance (<a class="reference external" href="https://github.com/pytest-dev/pytest/issues/535">#535</a>).</p></li>
</ul>
<p>More details can be found in the <a class="reference external" href="https://github.com/pytest-dev/pytest/pull/3317">original PR</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>in a future major release of pytest we will introduce class based markers,
at which point markers will no longer be limited to instances of <a class="reference internal" href="reference/reference.html#pytest.Mark" title="pytest.Mark"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mark</span></code></a>.</p>
</div>
</section>
</section>
<section id="cache-plugin-integrated-into-the-core">
<h2>cache plugin integrated into the core<a class="headerlink" href="#cache-plugin-integrated-into-the-core" title="Link to this heading">¶</a></h2>
<p>The functionality of the <a class="reference internal" href="how-to/cache.html#cache"><span class="std std-ref">core cache</span></a> plugin was previously distributed
as a third party plugin named <code class="docutils literal notranslate"><span class="pre">pytest-cache</span></code>.  The core plugin
is compatible regarding command line options and API usage except that you
can only store/receive data between test runs that is json-serializable.</p>
</section>
<section id="funcargs-and-pytest-funcarg">
<span id="historical-funcargs-and-pytest-funcargs"></span><h2>funcargs and <code class="docutils literal notranslate"><span class="pre">pytest_funcarg__</span></code><a class="headerlink" href="#funcargs-and-pytest-funcarg" title="Link to this heading">¶</a></h2>
<p>In versions prior to 2.3 there was no <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code> marker
and you had to use a magic <code class="docutils literal notranslate"><span class="pre">pytest_funcarg__NAME</span></code> prefix
for the fixture factory.  This remains and will remain supported
but is not anymore advertised as the primary means of declaring fixture
functions.</p>
</section>
<section id="pytest-yield-fixture-decorator">
<h2><code class="docutils literal notranslate"><span class="pre">&#64;pytest.yield_fixture</span></code> decorator<a class="headerlink" href="#pytest-yield-fixture-decorator" title="Link to this heading">¶</a></h2>
<p>Prior to version 2.10, in order to use a <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement to execute teardown code one
had to mark a fixture using the <code class="docutils literal notranslate"><span class="pre">yield_fixture</span></code> marker. From 2.10 onward, normal
fixtures can use <code class="docutils literal notranslate"><span class="pre">yield</span></code> directly so the <code class="docutils literal notranslate"><span class="pre">yield_fixture</span></code> decorator is no longer needed
and considered deprecated.</p>
</section>
<section id="pytest-header-in-setup-cfg">
<h2><code class="docutils literal notranslate"><span class="pre">[pytest]</span></code> header in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code><a class="headerlink" href="#pytest-header-in-setup-cfg" title="Link to this heading">¶</a></h2>
<p>Prior to 3.0, the supported section name was <code class="docutils literal notranslate"><span class="pre">[pytest]</span></code>. Due to how
this may collide with some distutils commands, the recommended
section name for <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> files is now <code class="docutils literal notranslate"><span class="pre">[tool:pytest]</span></code>.</p>
<p>Note that for <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> and <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code> files the section
name is <code class="docutils literal notranslate"><span class="pre">[pytest]</span></code>.</p>
</section>
<section id="applying-marks-to-pytest-mark-parametrize-parameters">
<h2>Applying marks to <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> parameters<a class="headerlink" href="#applying-marks-to-pytest-mark-parametrize-parameters" title="Link to this heading">¶</a></h2>
<p>Prior to version 3.1 the supported mechanism for marking values
used the syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;test_input,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;3+5&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2+4&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">((</span><span class="s2">&quot;6*9&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">))]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<p>This was an initial hack to support the feature but soon was demonstrated to be incomplete,
broken for passing functions or applying multiple marks with the same name but different parameters.</p>
<p>The old syntax is planned to be removed in pytest-4.0.</p>
</section>
<section id="pytest-mark-parametrize-argument-names-as-a-tuple">
<h2><code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> argument names as a tuple<a class="headerlink" href="#pytest-mark-parametrize-argument-names-as-a-tuple" title="Link to this heading">¶</a></h2>
<p>In versions prior to 2.4 one needed to specify the argument
names as a tuple.  This remains valid but the simpler <code class="docutils literal notranslate"><span class="pre">&quot;name1,name2,...&quot;</span></code>
comma-separated-string syntax is now advertised first because
it’s easier to write and produces less line noise.</p>
</section>
<section id="setup-is-now-an-autouse-fixture">
<h2>setup: is now an “autouse fixture”<a class="headerlink" href="#setup-is-now-an-autouse-fixture" title="Link to this heading">¶</a></h2>
<p>During development prior to the pytest-2.3 release the name
<code class="docutils literal notranslate"><span class="pre">pytest.setup</span></code> was used but before the release it was renamed
and moved to become part of the general fixture mechanism,
namely <a class="reference internal" href="how-to/fixtures.html#autouse-fixtures"><span class="std std-ref">自动使用的 fixtures（不需要显式请求的 fixtures）</span></a></p>
</section>
<section id="conditions-as-strings-instead-of-booleans">
<span id="string-conditions"></span><h2>Conditions as strings instead of booleans<a class="headerlink" href="#conditions-as-strings-instead-of-booleans" title="Link to this heading">¶</a></h2>
<p>Prior to pytest-2.4 the only way to specify skipif/xfail conditions was
to use strings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="s2">&quot;sys.version_info &gt;= (3,3)&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_function</span><span class="p">():</span> <span class="o">...</span>
</pre></div>
</div>
<p>During test function setup the skipif condition is evaluated by calling
<code class="docutils literal notranslate"><span class="pre">eval('sys.version_info</span> <span class="pre">&gt;=</span> <span class="pre">(3,0)',</span> <span class="pre">namespace)</span></code>.  The namespace contains
all the module globals, and <code class="docutils literal notranslate"><span class="pre">os</span></code> and <code class="docutils literal notranslate"><span class="pre">sys</span></code> as a minimum.</p>
<p>Since pytest-2.4 <a class="reference internal" href="how-to/skipping.html#condition-booleans"><span class="std std-ref">boolean conditions</span></a> are considered preferable
because markers can then be freely imported between test modules.
With strings you need to import not only the marker but all variables
used by the marker, which violates encapsulation.</p>
<p>The reason for specifying the condition as a string was that <code class="docutils literal notranslate"><span class="pre">pytest</span></code> can
report a summary of skip conditions based purely on the condition string.
With conditions as booleans you are required to specify a <code class="docutils literal notranslate"><span class="pre">reason</span></code> string.</p>
<p>Note that string conditions will remain fully supported and you are free
to use them if you have no need for cross-importing markers.</p>
<p>The evaluation of a condition string in <code class="docutils literal notranslate"><span class="pre">pytest.mark.skipif(conditionstring)</span></code>
or <code class="docutils literal notranslate"><span class="pre">pytest.mark.xfail(conditionstring)</span></code> takes place in a namespace
dictionary which is constructed as follows:</p>
<ul class="simple">
<li><p>the namespace is initialized by putting the <code class="docutils literal notranslate"><span class="pre">sys</span></code> and <code class="docutils literal notranslate"><span class="pre">os</span></code> modules
and the pytest <code class="docutils literal notranslate"><span class="pre">config</span></code> object into it.</p></li>
<li><p>updated with the module globals of the test function for which the
expression is applied.</p></li>
</ul>
<p>The pytest <code class="docutils literal notranslate"><span class="pre">config</span></code> object allows you to skip based on a test
configuration value which you might have added:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="s2">&quot;not config.getvalue(&#39;db&#39;)&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_function</span><span class="p">():</span> <span class="o">...</span>
</pre></div>
</div>
<p>The equivalent with “boolean conditions” is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">pytest</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;--db was not specified&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_function</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You cannot use <code class="docutils literal notranslate"><span class="pre">pytest.config.getvalue()</span></code> in code
imported before pytest’s argument parsing takes place.  For example,
<code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files are imported before command line parsing and thus
<code class="docutils literal notranslate"><span class="pre">config.getvalue()</span></code> will not execute correctly.</p>
</div>
</section>
<section id="pytest-set-trace">
<h2><code class="docutils literal notranslate"><span class="pre">pytest.set_trace()</span></code><a class="headerlink" href="#pytest-set-trace" title="Link to this heading">¶</a></h2>
<p>Previous to version 2.4 to set a break point in code one needed to use <code class="docutils literal notranslate"><span class="pre">pytest.set_trace()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">test_function</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>  <span class="c1"># invoke PDB debugger and tracing</span>
</pre></div>
</div>
<p>This is no longer needed and one can use the native <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pdb;pdb.set_trace()</span></code> call directly.</p>
<p>For more details see <a class="reference internal" href="how-to/failures.html#breakpoints"><span class="std std-ref">设置断点</span></a>.</p>
</section>
<section id="compat-properties">
<h2>“compat” properties<a class="headerlink" href="#compat-properties" title="Link to this heading">¶</a></h2>
<p>Access of <code class="docutils literal notranslate"><span class="pre">Module</span></code>, <code class="docutils literal notranslate"><span class="pre">Function</span></code>, <code class="docutils literal notranslate"><span class="pre">Class</span></code>, <code class="docutils literal notranslate"><span class="pre">Instance</span></code>, <code class="docutils literal notranslate"><span class="pre">File</span></code> and <code class="docutils literal notranslate"><span class="pre">Item</span></code> through <code class="docutils literal notranslate"><span class="pre">Node</span></code> instances have long
been documented as deprecated, but started to emit warnings from pytest <code class="docutils literal notranslate"><span class="pre">3.9</span></code> and onward.</p>
<p>Users should just <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pytest</span></code> and access those objects using the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> module.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015, holger krekel and pytest-dev team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Historical Notes</a><ul>
<li><a class="reference internal" href="#marker-revamp-and-iteration">Marker revamp and iteration</a><ul>
<li><a class="reference internal" href="#updating-code">Updating code</a></li>
<li><a class="reference internal" href="#related-issues">Related issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cache-plugin-integrated-into-the-core">cache plugin integrated into the core</a></li>
<li><a class="reference internal" href="#funcargs-and-pytest-funcarg">funcargs and <code class="docutils literal notranslate"><span class="pre">pytest_funcarg__</span></code></a></li>
<li><a class="reference internal" href="#pytest-yield-fixture-decorator"><code class="docutils literal notranslate"><span class="pre">&#64;pytest.yield_fixture</span></code> decorator</a></li>
<li><a class="reference internal" href="#pytest-header-in-setup-cfg"><code class="docutils literal notranslate"><span class="pre">[pytest]</span></code> header in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code></a></li>
<li><a class="reference internal" href="#applying-marks-to-pytest-mark-parametrize-parameters">Applying marks to <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> parameters</a></li>
<li><a class="reference internal" href="#pytest-mark-parametrize-argument-names-as-a-tuple"><code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> argument names as a tuple</a></li>
<li><a class="reference internal" href="#setup-is-now-an-autouse-fixture">setup: is now an “autouse fixture”</a></li>
<li><a class="reference internal" href="#conditions-as-strings-instead-of-booleans">Conditions as strings instead of booleans</a></li>
<li><a class="reference internal" href="#pytest-set-trace"><code class="docutils literal notranslate"><span class="pre">pytest.set_trace()</span></code></a></li>
<li><a class="reference internal" href="#compat-properties">“compat” properties</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=7c91f8fd"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>