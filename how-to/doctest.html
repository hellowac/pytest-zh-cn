<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../search.html" /><link rel="next" title="如何重新运行失败的测试并在测试运行之间保持状态" href="cache.html" /><link rel="prev" title="如何使用 猴子补丁/mock 模块和环境" href="monkeypatch.html" />
        <link rel="canonical" href="https://docs.pytest.org/en/stable/how-to/doctest.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>如何运行文档测试 - pytest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments_pytest.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/pytest-custom.css?v=eb7c59a4" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">pytest documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/pytest1.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">入门</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">操作指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 操作指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usage.html">如何调用 pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="assert.html">如何在测试中编写和报告断言</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixtures.html">如何使用 fixture</a></li>
<li class="toctree-l2"><a class="reference internal" href="mark.html">如何用属性标记测试函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="parametrize.html">如何参数化fixtures和测试函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="tmp_path.html">如何在测试中使用临时目录和文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="monkeypatch.html">如何使用 猴子补丁/mock 模块和环境</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">如何运行文档测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">如何重新运行失败的测试并在测试运行之间保持状态</a></li>
<li class="toctree-l2"><a class="reference internal" href="failures.html">如何处理测试失败</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">管理 pytest 的输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">如何管理日志记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture-stdout-stderr.html">如何捕获 stdout/stderr 输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture-warnings.html">如何捕获警告</a></li>
<li class="toctree-l2"><a class="reference internal" href="skipping.html">如何使用 skip 和 xfail 处理无法成功的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">如何安装和使用插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_plugins.html">编写插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_hook_functions.html">编写钩子函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="existingtestsuite.html">如何将 pytest 与现有测试套件结合使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="unittest.html">如何在 pytest 中使用基于 unittest 的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="xunit_setup.html">如何实现 xunit 样式的设置</a></li>
<li class="toctree-l2"><a class="reference internal" href="bash-completion.html">如何设置 bash 补全</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">参考指南</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 参考指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">API 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/fixtures.html">Fixtures 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/customize.html">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exit-codes.html">退出码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/plugin_list.html">Pytest 插件列表</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanation/index.html">解答</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 解答</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanation/anatomy.html">测试剖析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/fixtures.html">关于 fixtures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/goodpractices.html">良好的集成实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/pythonpath.html">pytest 导入机制和 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> / <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/ci.html">CI Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/flaky.html">不稳定的测试</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../example/index.html">示例和自定义技巧</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 示例和自定义技巧</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../example/reportingdemo.html">使用 pytest 的 Python 故障报告演示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/simple.html">基本模式和示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/parametrize.html">参数化测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/markers.html">使用自定义标记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/special.html">可以查看所有收集到的测试的会话fixture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/pythoncollection.html">改变标准 (Python) 测试的发现机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/nonpython.html">使用非 Python 测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/customdirectory.html">使用自定义目录收集器</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">关于项目</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">更改日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backwards-compatibility.html">向后兼容政策</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backwards-compatibility.html#id2">历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backwards-compatibility.html#python">Python版本支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sponsor.html">赞助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tidelift.html">pytest 企业版</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">许可</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">联系渠道</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">游泳的链接</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/pytest/">pytest @ PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytest-dev/pytest/">pytest @ GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytest-dev/pytest/issues">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://media.readthedocs.org/pdf/pytest/latest/pytest.pdf">PDF Documentation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="doctest">
<span id="id1"></span><h1>如何运行文档测试<a class="headerlink" href="#doctest" title="Link to this heading">¶</a></h1>
<p><strong>How to run doctests</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>默认情况下，所有匹配 <code class="docutils literal notranslate"><span class="pre">test*.txt</span></code> 模式的文件将通过 Python 标准 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> 模块进行运行。你可以通过以下命令更改模式：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-glob<span class="o">=</span><span class="s2">&quot;*.rst&quot;</span>
</pre></div>
</div>
<p>在命令行中可以多次指定 <code class="docutils literal notranslate"><span class="pre">--doctest-glob</span></code>。</p>
<p>如果你有一个这样的文本文件：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># content of test_example.txt

hello this is a doctest
&gt;&gt;&gt; x = 3
&gt;&gt;&gt; x
3
</pre></div>
</div>
<p>那么你可以直接调用 <code class="docutils literal notranslate"><span class="pre">pytest</span></code>：</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest
<span class=" -Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-8.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
collected 1 item

test_example.txt <span class=" -Color -Color-Green">.</span>                                                   <span class=" -Color -Color-Green">[100%]</span>

<span class=" -Color -Color-Green">============================ </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.12s =============================</span>
</pre></div>
</div>
<p>默认情况下，pytest 将收集 <code class="docutils literal notranslate"><span class="pre">test*.txt</span></code> 文件以查找 doctest 指令，但你可以使用 <code class="docutils literal notranslate"><span class="pre">--doctest-glob</span></code> 选项传递额外的模式（允许多次使用）。</p>
<p>除了文本文件，你还可以直接从类和函数的文档字符串中执行 doctests，包括来自测试模块的：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of mymodule.py</span>
<span class="k">def</span> <span class="nf">something</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a doctest in a docstring</span>
<span class="sd">    &gt;&gt;&gt; something()</span>
<span class="sd">    42</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">42</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pytest<span class="w"> </span>--doctest-modules
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.x.y,<span class="w"> </span>pytest-8.x.y,<span class="w"> </span>pluggy-1.x.y
rootdir:<span class="w"> </span>/home/sweet/project
collected<span class="w"> </span><span class="m">2</span><span class="w"> </span>items

mymodule.py<span class="w"> </span>.<span class="w">                                                        </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_example.txt<span class="w"> </span>.<span class="w">                                                   </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">============================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">=============================</span>
</pre></div>
</div>
<p>你可以通过将这些更改放入 pytest.ini 文件中，使其在项目中永久生效，如下所示：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">--doctest-modules</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>By default, all files matching the <code class="docutils literal notranslate"><span class="pre">test*.txt</span></code> pattern will
be run through the python standard <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> module.  You
can change the pattern by issuing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-glob<span class="o">=</span><span class="s2">&quot;*.rst&quot;</span>
</pre></div>
</div>
<p>on the command line. <code class="docutils literal notranslate"><span class="pre">--doctest-glob</span></code> can be given multiple times in the command-line.</p>
<p>If you then have a text file like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># content of test_example.txt

hello this is a doctest
&gt;&gt;&gt; x = 3
&gt;&gt;&gt; x
3
</pre></div>
</div>
<p>then you can just invoke <code class="docutils literal notranslate"><span class="pre">pytest</span></code> directly:</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest
<span class=" -Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-8.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
collected 1 item

test_example.txt <span class=" -Color -Color-Green">.</span>                                                   <span class=" -Color -Color-Green">[100%]</span>

<span class=" -Color -Color-Green">============================ </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.12s =============================</span>
</pre></div>
</div>
<p>By default, pytest will collect <code class="docutils literal notranslate"><span class="pre">test*.txt</span></code> files looking for doctest directives, but you
can pass additional globs using the <code class="docutils literal notranslate"><span class="pre">--doctest-glob</span></code> option (multi-allowed).</p>
<p>In addition to text files, you can also execute doctests directly from docstrings of your classes
and functions, including from test modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of mymodule.py</span>
<span class="k">def</span> <span class="nf">something</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a doctest in a docstring</span>
<span class="sd">    &gt;&gt;&gt; something()</span>
<span class="sd">    42</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">42</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pytest<span class="w"> </span>--doctest-modules
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.x.y,<span class="w"> </span>pytest-8.x.y,<span class="w"> </span>pluggy-1.x.y
rootdir:<span class="w"> </span>/home/sweet/project
collected<span class="w"> </span><span class="m">2</span><span class="w"> </span>items

mymodule.py<span class="w"> </span>.<span class="w">                                                        </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_example.txt<span class="w"> </span>.<span class="w">                                                   </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">============================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">=============================</span>
</pre></div>
</div>
<p>You can make these changes permanent in your project by
putting them into a pytest.ini file like this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">--doctest-modules</span>
</pre></div>
</div>
</div></div>
<section id="id2">
<h2>编码<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p><strong>Encoding</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p>默认编码为 <strong>UTF-8</strong>，但您可以使用 <code class="docutils literal notranslate"><span class="pre">doctest_encoding</span></code> ini 选项指定将用于这些 doctest 文件的编码：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest.ini 的内容</span>
<span class="k">[pytest]</span>
<span class="na">doctest_encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">latin1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p>The default encoding is <strong>UTF-8</strong>, but you can specify the encoding
that will be used for those doctest files using the
<code class="docutils literal notranslate"><span class="pre">doctest_encoding</span></code> ini option:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">doctest_encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">latin1</span>
</pre></div>
</div>
</div></div>
</section>
<section id="using-doctest-options">
<span id="id3"></span><h2>使用 ‘doctest’ 选项<a class="headerlink" href="#using-doctest-options" title="Link to this heading">¶</a></h2>
<p><strong>Using ‘doctest’ options</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p>Python 的标准 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> 模块提供了一些 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#option-flags-and-directives" title="(in Python v3.13)"><span class="xref std std-ref">options</span></a> 用于配置 doctest 测试的严格程度。在 pytest 中，你可以通过配置文件启用这些标志。</p>
<p>例如，为了使 pytest 忽略尾随空格并忽略冗长的异常堆栈跟踪，你可以这样写：</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">doctest_optionflags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">NORMALIZE_WHITESPACE IGNORE_EXCEPTION_DETAIL</span>
</pre></div>
</div>
<p>另外，选项也可以通过文档测试中的内联注释来启用：</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; something_that_raises()  # doctest: +IGNORE_EXCEPTION_DETAIL
Traceback (most recent call last):
ValueError: ...
</pre></div>
</div>
<p>pytest 还引入了新的选项：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOW_UNICODE</span></code>：启用后，预期 doctest 输出中的 unicode 字符串将去掉 <code class="docutils literal notranslate"><span class="pre">u</span></code> 前缀。这使得 doctests 可以在 Python 2 和 Python 3 中无差异地运行。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOW_BYTES</span></code>：类似地，预期 doctest 输出中的字节字符串将去掉 <code class="docutils literal notranslate"><span class="pre">b</span></code> 前缀。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NUMBER</span></code>：启用后，浮点数只需匹配到你在预期 doctest 输出中写的精度。数字使用 <a class="reference internal" href="../reference/reference.html#pytest.approx" title="pytest.approx"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.approx()</span></code></a> 进行比较，相对容差等于精度。例如，以下输出在比较 <code class="docutils literal notranslate"><span class="pre">3.14</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pytest.approx(math.pi,</span> <span class="pre">rel=10**-2)</span></code> 时只需匹配到 2 位小数：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="go">3.14</span>
</pre></div>
</div>
<p>如果你写了 <code class="docutils literal notranslate"><span class="pre">3.1416</span></code>，那么实际输出需要大约匹配到 4 位小数；依此类推。</p>
<p>这避免了由浮点精度限制引起的误报，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Expected</span><span class="p">:</span>
    <span class="mf">0.233</span>
<span class="n">Got</span><span class="p">:</span>
    <span class="mf">0.23300000000000001</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">NUMBER</span></code> 还支持浮点数列表——事实上，它匹配输出中出现的任何浮点数，甚至在字符串内部！这意味着在你的配置文件中的 <code class="docutils literal notranslate"><span class="pre">doctest_optionflags</span></code> 中全局启用可能并不合适。</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 5.1.</span></p>
</div>
</li>
</ul>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>Python’s standard <a class="reference external" href="https://docs.python.org/3/library/doctest.html#module-doctest" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> module provides some <a class="reference external" href="https://docs.python.org/3/library/doctest.html#option-flags-and-directives" title="(in Python v3.13)"><span class="xref std std-ref">options</span></a> to configure the strictness of doctest tests. In pytest, you can enable those flags using the configuration file.</p>
<p>For example, to make pytest ignore trailing whitespaces and ignore lengthy exception stack traces you can just write:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">doctest_optionflags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">NORMALIZE_WHITESPACE IGNORE_EXCEPTION_DETAIL</span>
</pre></div>
</div>
<p>Alternatively, options can be enabled by an inline comment in the doc test itself:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; something_that_raises()  # doctest: +IGNORE_EXCEPTION_DETAIL
Traceback (most recent call last):
ValueError: ...
</pre></div>
</div>
<p>pytest also introduces new options:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOW_UNICODE</span></code>: when enabled, the <code class="docutils literal notranslate"><span class="pre">u</span></code> prefix is stripped from unicode strings in expected doctest output. This allows doctests to run in Python 2 and Python 3 unchanged.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOW_BYTES</span></code>: similarly, the <code class="docutils literal notranslate"><span class="pre">b</span></code> prefix is stripped from byte strings in expected doctest output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NUMBER</span></code>: when enabled, floating-point numbers only need to match as far as the precision you have written in the expected doctest output. The numbers are compared using <a class="reference internal" href="../reference/reference.html#pytest.approx" title="pytest.approx"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.approx()</span></code></a> with relative tolerance equal to the precision. For example, the following output would only need to match to 2 decimal places when comparing <code class="docutils literal notranslate"><span class="pre">3.14</span></code> to <code class="docutils literal notranslate"><span class="pre">pytest.approx(math.pi,</span> <span class="pre">rel=10**-2)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="go">3.14</span>
</pre></div>
</div>
<p>If you wrote <code class="docutils literal notranslate"><span class="pre">3.1416</span></code> then the actual output would need to match to
approximately 4 decimal places; and so on.</p>
<p>This avoids false positives caused by limited floating-point precision, like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Expected</span><span class="p">:</span>
    <span class="mf">0.233</span>
<span class="n">Got</span><span class="p">:</span>
    <span class="mf">0.23300000000000001</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">NUMBER</span></code> also supports lists of floating-point numbers – in fact, it
matches floating-point numbers appearing anywhere in the output, even inside
a string! This means that it may not be appropriate to enable globally in
<code class="docutils literal notranslate"><span class="pre">doctest_optionflags</span></code> in your configuration file.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 5.1.</span></p>
</div>
</li>
</ul>
</div></div>
</section>
<section id="id4">
<h2>失败时继续<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p><strong>Continue on failure</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>默认情况下，pytest 只会报告给定 doctest 的第一次失败。如果您想在失败时继续测试，请执行以下操作：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-continue-on-failure
</pre></div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><p>By default, pytest would report only the first failure for a given doctest. If
you want to continue the test even when you have failures, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-continue-on-failure
</pre></div>
</div>
</div></div>
</section>
<section id="id5">
<h2>输出格式<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p><strong>Output format</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><p>您可以使用选项中的标准 doctest 模块格式之一来更改 doctest 失败时的 diff 输出格式（请参阅 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_UDIFF" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_UDIFF</span></code></a>、 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_CDIFF" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_CDIFF</span></code></a>、 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_NDIFF" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_NDIFF</span></code></a>、 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_ONLY_FIRST_FAILURE" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_ONLY_FIRST_FAILURE</span></code></a>）：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>none
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>udiff
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>cdiff
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>ndiff
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>only_first_failure
</pre></div>
</div>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><p>You can change the diff output format on failure for your doctests
by using one of standard doctest modules format in options
(see <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_UDIFF" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_UDIFF</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_CDIFF" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_CDIFF</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_NDIFF" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_NDIFF</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_ONLY_FIRST_FAILURE" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_ONLY_FIRST_FAILURE</span></code></a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>none
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>udiff
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>cdiff
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>ndiff
pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>--doctest-report<span class="w"> </span>only_first_failure
</pre></div>
</div>
</div></div>
</section>
<section id="pytest">
<h2>pytest 特定功能<a class="headerlink" href="#pytest" title="Link to this heading">¶</a></h2>
<p><strong>pytest-specific features</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><p>提供的一些功能可使编写 文档测试(doctest) 更加容易或更好地与现有测试套件集成。但请记住，使用这些功能将使 文档测试(doctest) 与标准 <code class="docutils literal notranslate"><span class="pre">doctests</span></code> 模块不兼容。</p>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><p>Some features are provided to make writing doctests easier or with better integration with your existing test suite. Keep in mind however that by using those features you will make your doctests incompatible with the standard <code class="docutils literal notranslate"><span class="pre">doctests</span></code> module.</p>
</div></div>
<section id="fixtures">
<h3>使用 fixtures<a class="headerlink" href="#fixtures" title="Link to this heading">¶</a></h3>
<p><strong>Using fixtures</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-6-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-6-6-0" name="6-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-6-6-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-6-6-1" name="6-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-6-6-0" class="sphinx-tabs-panel" id="panel-6-6-0" name="6-0" role="tabpanel" tabindex="0"><p>可以使用 <code class="docutils literal notranslate"><span class="pre">getfixture</span></code> 辅助函数来使用 fixtures:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># content of example.rst
&gt;&gt;&gt; tmp = getfixture(&#39;tmp_path&#39;)
&gt;&gt;&gt; ...
&gt;&gt;&gt;
</pre></div>
</div>
<p>请注意，fixture 需要在 pytest 可见的地方定义，例如 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件或插件；正常的 Python 文件中的文档字符串通常不会被扫描以查找 fixtures，除非通过 <a class="reference internal" href="../reference/reference.html#confval-31"><code class="xref std std-confval docutils literal notranslate"><span class="pre">python_files</span></code></a> 明确配置。</p>
<p>此外，在执行文本 doctest 文件时，支持 <a class="reference internal" href="fixtures.html#usefixtures"><span class="std std-ref">usefixtures</span></a> 标记和标记为 <a class="reference internal" href="fixtures.html#autouse"><span class="std std-ref">autouse</span></a> 的 fixtures。</p>
</div><div aria-labelledby="tab-6-6-1" class="sphinx-tabs-panel" hidden="true" id="panel-6-6-1" name="6-1" role="tabpanel" tabindex="0"><p>It is possible to use fixtures using the <code class="docutils literal notranslate"><span class="pre">getfixture</span></code> helper:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># content of example.rst
&gt;&gt;&gt; tmp = getfixture(&#39;tmp_path&#39;)
&gt;&gt;&gt; ...
&gt;&gt;&gt;
</pre></div>
</div>
<p>Note that the fixture needs to be defined in a place visible by pytest, for example, a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>
file or plugin; normal python files containing docstrings are not normally scanned for fixtures
unless explicitly configured by <a class="reference internal" href="../reference/reference.html#confval-31"><code class="xref std std-confval docutils literal notranslate"><span class="pre">python_files</span></code></a>.</p>
<p>Also, the <a class="reference internal" href="fixtures.html#usefixtures"><span class="std std-ref">usefixtures</span></a> mark and fixtures marked as <a class="reference internal" href="fixtures.html#autouse"><span class="std std-ref">autouse</span></a> are supported
when executing text doctest files.</p>
</div></div>
</section>
<section id="doctest-namespace-fixture">
<span id="doctest-namespace"></span><h3>‘doctest_namespace’ fixture<a class="headerlink" href="#doctest-namespace-fixture" title="Link to this heading">¶</a></h3>
<p><strong>‘doctest_namespace’ fixture</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-7-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-7-7-0" name="7-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-7-7-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-7-7-1" name="7-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-7-7-0" class="sphinx-tabs-panel" id="panel-7-7-0" name="7-0" role="tabpanel" tabindex="0"><p><code class="docutils literal notranslate"><span class="pre">doctest_namespace</span></code> fixture 可用于将项目注入到你的 文档测试(doctests) 运行的命名空间中。它旨在与自己的 fixtures 一起使用，为使用它们的测试提供上下文。</p>
<p><code class="docutils literal notranslate"><span class="pre">doctest_namespace</span></code> 是一个标准的 <code class="docutils literal notranslate"><span class="pre">dict</span></code> 对象，你可以将希望出现在 文档测试(doctest) 命名空间中的对象放入其中：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of conftest.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">numpy</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_np</span><span class="p">(</span><span class="n">doctest_namespace</span><span class="p">):</span>
    <span class="n">doctest_namespace</span><span class="p">[</span><span class="s2">&quot;np&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span>
</pre></div>
</div>
<p>然后可以直接在你的 doctests 中使用：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of numpy.py</span>
<span class="k">def</span> <span class="nf">arange</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; len(a)</span>
<span class="sd">    10</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>请注意，与普通的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 一样，fixtures 会在 conftest 所在的目录树中被发现。这意味着如果你将你的 文档测试(doctest) 和源代码放在一起，相关的 conftest.py 需要在同一目录树中。fixtures 不会在兄弟目录树中被发现！</p>
</div><div aria-labelledby="tab-7-7-1" class="sphinx-tabs-panel" hidden="true" id="panel-7-7-1" name="7-1" role="tabpanel" tabindex="0"><p>The <code class="docutils literal notranslate"><span class="pre">doctest_namespace</span></code> fixture can be used to inject items into the
namespace in which your doctests run. It is intended to be used within
your own fixtures to provide the tests that use them with context.</p>
<p><code class="docutils literal notranslate"><span class="pre">doctest_namespace</span></code> is a standard <code class="docutils literal notranslate"><span class="pre">dict</span></code> object into which you
place the objects you want to appear in the doctest namespace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of conftest.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">numpy</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_np</span><span class="p">(</span><span class="n">doctest_namespace</span><span class="p">):</span>
    <span class="n">doctest_namespace</span><span class="p">[</span><span class="s2">&quot;np&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span>
</pre></div>
</div>
<p>which can then be used in your doctests directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of numpy.py</span>
<span class="k">def</span> <span class="nf">arange</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; len(a)</span>
<span class="sd">    10</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note that like the normal <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>, the fixtures are discovered in the directory tree conftest is in.
Meaning that if you put your doctest with your source code, the relevant conftest.py needs to be in the same directory tree.
Fixtures will not be discovered in a sibling directory tree!</p>
</div></div>
</section>
<section id="id6">
<h3>跳过测试<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p><strong>Skipping tests</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-8-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-8-8-0" name="8-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-8-8-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-8-8-1" name="8-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-8-8-0" class="sphinx-tabs-panel" id="panel-8-8-0" name="8-0" role="tabpanel" tabindex="0"><p>出于同样的原因，有人可能想要跳过正常测试，也可以在 文档测试(doctests) 中跳过测试。</p>
<p>要在 doctest 中跳过单个检查，可以使用标准的 <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.SKIP" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">doctest.SKIP</span></code></a> 指令：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_random</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; random.random()  # doctest: +SKIP</span>
<span class="sd">    0.156231223</span>

<span class="sd">    &gt;&gt;&gt; 1 + 1</span>
<span class="sd">    2</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>这将跳过第一个检查，但不会跳过第二个。</p>
<p>pytest 还允许在 文档测试(doctests) 中使用标准 pytest 函数 <a class="reference internal" href="../reference/reference.html#pytest.skip" title="pytest.skip"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.skip()</span></code></a> 和 <a class="reference internal" href="../reference/reference.html#pytest.xfail" title="pytest.xfail"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.xfail()</span></code></a>，这可能很有用，因为这样你可以根据外部条件跳过/预期失败测试：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import sys, pytest
&gt;&gt;&gt; if sys.platform.startswith(&#39;win&#39;):
...     pytest.skip(&#39;this doctest does not work on Windows&#39;)
...
&gt;&gt;&gt; import fcntl
&gt;&gt;&gt; ...
</pre></div>
</div>
<p>然而，不鼓励使用这些函数，因为它降低了文档字符串的可读性。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../reference/reference.html#pytest.skip" title="pytest.skip"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.skip()</span></code></a> 和 <a class="reference internal" href="../reference/reference.html#pytest.xfail" title="pytest.xfail"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.xfail()</span></code></a> 的行为取决于 doctests 是否在 Python 文件（文档字符串中）或包含文本的文本文件中：</p>
<ul class="simple">
<li><p>Python 模块（文档字符串）：这些函数只在特定的文档字符串中起作用，允许同一模块中的其他文档字符串正常执行。</p></li>
<li><p>文本文件：这些函数将跳过/预期失败整个文件的检查。</p></li>
</ul>
</div>
</div><div aria-labelledby="tab-8-8-1" class="sphinx-tabs-panel" hidden="true" id="panel-8-8-1" name="8-1" role="tabpanel" tabindex="0"><p>For the same reasons one might want to skip normal tests, it is also possible to skip tests inside doctests.</p>
<p>To skip a single check inside a doctest you can use the standard <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.SKIP" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">doctest.SKIP</span></code></a> directive:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_random</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; random.random()  # doctest: +SKIP</span>
<span class="sd">    0.156231223</span>

<span class="sd">    &gt;&gt;&gt; 1 + 1</span>
<span class="sd">    2</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This will skip the first check, but not the second.</p>
<p>pytest also allows using the standard pytest functions <a class="reference internal" href="../reference/reference.html#pytest.skip" title="pytest.skip"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.skip()</span></code></a> and <a class="reference internal" href="../reference/reference.html#pytest.xfail" title="pytest.xfail"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.xfail()</span></code></a> inside doctests, which might be useful because you can then skip/xfail tests based on external conditions:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import sys, pytest
&gt;&gt;&gt; if sys.platform.startswith(&#39;win&#39;):
...     pytest.skip(&#39;this doctest does not work on Windows&#39;)
...
&gt;&gt;&gt; import fcntl
&gt;&gt;&gt; ...
</pre></div>
</div>
<p>However using those functions is discouraged because it reduces the readability of the docstring.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../reference/reference.html#pytest.skip" title="pytest.skip"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.skip()</span></code></a> and <a class="reference internal" href="../reference/reference.html#pytest.xfail" title="pytest.xfail"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.xfail()</span></code></a> behave differently depending if the doctests are in a Python file (in docstrings) or a text file containing doctests intermingled with text:</p>
<ul class="simple">
<li><p>Python modules (docstrings): the functions only act in that specific docstring, letting the other docstrings in the same module execute as normal.</p></li>
<li><p>Text files: the functions will skip/xfail the checks for the rest of the entire file.</p></li>
</ul>
</div>
</div></div>
</section>
</section>
<section id="id7">
<h2>替代方案<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<p><strong>Alternatives</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-9-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-9-9-0" name="9-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-9-9-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-9-9-1" name="9-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-9-9-0" class="sphinx-tabs-panel" id="panel-9-9-0" name="9-0" role="tabpanel" tabindex="0"><p>虽然内置的 pytest 支持为使用 文档测试(doctests) 提供了一系列良好的功能，但如果你广泛使用它们，可能会对那些添加更多功能并包含 pytest 集成的外部包感兴趣：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/astropy/pytest-doctestplus">pytest-doctestplus</a>: 提供高级的 文档测试(doctest) 支持，并启用对 reStructuredText (“.rst”) 文件的测试。</p></li>
<li><p><a class="reference external" href="https://sybil.readthedocs.io">Sybil</a>：提供了一种通过从文档源解析示例并将解析后的示例作为正常测试运行的一部分进行测试的方法。</p></li>
</ul>
</div><div aria-labelledby="tab-9-9-1" class="sphinx-tabs-panel" hidden="true" id="panel-9-9-1" name="9-1" role="tabpanel" tabindex="0"><p>While the built-in pytest support provides a good set of functionalities for using doctests, if you use them extensively you might be interested in those external packages which add many more features, and include pytest integration:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/astropy/pytest-doctestplus">pytest-doctestplus</a>: provides advanced doctest support and enables the testing of reStructuredText (“.rst”) files.</p></li>
<li><p><a class="reference external" href="https://sybil.readthedocs.io">Sybil</a>: provides a way to test examples in your documentation by parsing them from the documentation source and evaluating the parsed examples as part of your normal test run.</p></li>
</ul>
</div></div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cache.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">如何重新运行失败的测试并在测试运行之间保持状态</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="monkeypatch.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">如何使用 猴子补丁/mock 模块和环境</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015, holger krekel and pytest-dev team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">如何运行文档测试</a><ul>
<li><a class="reference internal" href="#id2">编码</a></li>
<li><a class="reference internal" href="#using-doctest-options">使用 ‘doctest’ 选项</a></li>
<li><a class="reference internal" href="#id4">失败时继续</a></li>
<li><a class="reference internal" href="#id5">输出格式</a></li>
<li><a class="reference internal" href="#pytest">pytest 特定功能</a><ul>
<li><a class="reference internal" href="#fixtures">使用 fixtures</a></li>
<li><a class="reference internal" href="#doctest-namespace-fixture">‘doctest_namespace’ fixture</a></li>
<li><a class="reference internal" href="#id6">跳过测试</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">替代方案</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=7c91f8fd"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3030b3cb"></script>
    </body>
</html>