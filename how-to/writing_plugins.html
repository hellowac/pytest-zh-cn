<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../search.html" /><link rel="next" title="编写钩子函数" href="writing_hook_functions.html" /><link rel="prev" title="如何安装和使用插件" href="plugins.html" />
        <link rel="canonical" href="https://docs.pytest.org/en/stable/how-to/writing_plugins.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>编写插件 - pytest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments_pytest.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/pytest-custom.css?v=eb7c59a4" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">pytest documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/pytest1.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">入门</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">操作指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 操作指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usage.html">如何调用 pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="assert.html">如何在测试中编写和报告断言</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixtures.html">如何使用 fixture</a></li>
<li class="toctree-l2"><a class="reference internal" href="mark.html">如何用属性标记测试函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="parametrize.html">如何参数化fixtures和测试函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="tmp_path.html">如何在测试中使用临时目录和文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="monkeypatch.html">如何使用 猴子补丁/mock 模块和环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="doctest.html">如何运行文档测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">如何重新运行失败的测试并在测试运行之间保持状态</a></li>
<li class="toctree-l2"><a class="reference internal" href="failures.html">如何处理测试失败</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">管理 pytest 的输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">如何管理日志记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture-stdout-stderr.html">如何捕获 stdout/stderr 输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture-warnings.html">如何捕获警告</a></li>
<li class="toctree-l2"><a class="reference internal" href="skipping.html">如何使用 skip 和 xfail 处理无法成功的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">如何安装和使用插件</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">编写插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_hook_functions.html">编写钩子函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="existingtestsuite.html">如何将 pytest 与现有测试套件结合使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="unittest.html">如何在 pytest 中使用基于 unittest 的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="xunit_setup.html">如何实现 xunit 样式的设置</a></li>
<li class="toctree-l2"><a class="reference internal" href="bash-completion.html">如何设置 bash 补全</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">参考指南</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 参考指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference.html">API 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/fixtures.html">Fixtures 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/customize.html">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exit-codes.html">退出码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/plugin_list.html">Pytest 插件列表</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanation/index.html">解答</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 解答</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanation/anatomy.html">测试剖析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/fixtures.html">关于 fixtures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/goodpractices.html">良好的集成实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/pythonpath.html">pytest 导入机制和 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> / <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/ci.html">CI Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/flaky.html">不稳定的测试</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../example/index.html">示例和自定义技巧</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 示例和自定义技巧</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../example/reportingdemo.html">使用 pytest 的 Python 故障报告演示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/simple.html">基本模式和示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/parametrize.html">参数化测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/markers.html">使用自定义标记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/special.html">可以查看所有收集到的测试的会话fixture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/pythoncollection.html">改变标准 (Python) 测试的发现机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/nonpython.html">使用非 Python 测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example/customdirectory.html">使用自定义目录收集器</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">关于项目</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">更改日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backwards-compatibility.html">向后兼容政策</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backwards-compatibility.html#id2">历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backwards-compatibility.html#python">Python版本支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sponsor.html">赞助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tidelift.html">pytest 企业版</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">许可</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">联系渠道</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">游泳的链接</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/pytest/">pytest @ PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytest-dev/pytest/">pytest @ GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pytest-dev/pytest/issues">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://media.readthedocs.org/pdf/pytest/latest/pytest.pdf">PDF Documentation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="writing-plugins">
<span id="plugins"></span><span id="id1"></span><h1>编写插件<a class="headerlink" href="#writing-plugins" title="Link to this heading">¶</a></h1>
<p><strong>Writing plugins</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>实现适用于您项目的 <a class="reference external" href="localconftestplugins">本地 conftest 插件</a> 或者适用于多个项目的 <a class="reference external" href="pip-installableplugins">pip 可安装插件</a> 非常简单，这些插件还可以用于第三方项目。如只需使用而不编写插件，请参阅 <a class="reference internal" href="plugins.html#using-plugins"><span class="std std-ref">如何安装和使用插件</span></a>。</p>
<p>一个插件包含一个或多个钩子函数。<a class="reference internal" href="writing_hook_functions.html#writinghooks"><span class="std std-ref">Writing hooks</span></a> 讲解了如何编写钩子函数的基本内容和详细信息。<code class="docutils literal notranslate"><span class="pre">pytest</span></code> 通过调用以下插件的 <a class="reference internal" href="../reference/reference.html#hook-reference"><span class="std std-ref">明确定义的钩子</span></a> 实现配置、收集、运行和报告的各个方面：</p>
<ul class="simple">
<li><p>内置插件：从 pytest 的内部 <code class="docutils literal notranslate"><span class="pre">_pytest</span></code> 目录加载。</p></li>
<li><p><a class="reference internal" href="plugins.html#extplugins"><span class="std std-ref">外部插件</span></a>：通过其打包元数据中的 <a class="reference internal" href="#pip-installable-plugins"><span class="std std-ref">入口点</span></a> 发现已安装的第三方模块。</p></li>
<li><p><a class="reference external" href="conftest.pyplugins">conftest.py 插件</a> ：在测试目录中自动发现的模块。</p></li>
</ul>
<p>原则上，每次钩子调用都是一次 <code class="docutils literal notranslate"><span class="pre">1:N</span></code> 的 Python 函数调用，其中 <code class="docutils literal notranslate"><span class="pre">N</span></code> 是给定规范注册的实现函数数量。所有规范和实现都遵循 <code class="docutils literal notranslate"><span class="pre">pytest_</span></code> 前缀命名约定，使它们易于区分和查找。</p>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>It is easy to implement <a class="reference internal" href="#local-conftest-plugins">local conftest plugins</a> for your own project
or <a class="reference internal" href="#pip-installable-plugins">pip-installable plugins</a> that can be used throughout many projects,
including third party projects.  Please refer to <a class="reference internal" href="plugins.html#using-plugins"><span class="std std-ref">如何安装和使用插件</span></a> if you
only want to use but not write plugins.</p>
<p>A plugin contains one or multiple hook functions. <a class="reference internal" href="writing_hook_functions.html#writinghooks"><span class="std std-ref">Writing hooks</span></a>
explains the basics and details of how you can write a hook function yourself.
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> implements all aspects of configuration, collection, running and
reporting by calling <a class="reference internal" href="../reference/reference.html#hook-reference"><span class="std std-ref">well specified hooks</span></a> of the following plugins:</p>
<ul class="simple">
<li><p>builtin plugins: loaded from pytest’s internal <code class="docutils literal notranslate"><span class="pre">_pytest</span></code> directory.</p></li>
<li><p><a class="reference internal" href="plugins.html#extplugins"><span class="std std-ref">external plugins</span></a>: installed third-party modules discovered</p></li>
</ul>
<p>through <a class="reference internal" href="#pip-installable-plugins"><span class="std std-ref">entry points</span></a> in their packaging metadata</p>
<ul class="simple">
<li><p><a class="reference internal" href="#conftest-py-plugins">conftest.py plugins</a>: modules auto-discovered in test directories</p></li>
</ul>
<p>In principle, each hook call is a <code class="docutils literal notranslate"><span class="pre">1:N</span></code> Python function call where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the
number of registered implementation functions for a given specification.
All specifications and implementations follow the <code class="docutils literal notranslate"><span class="pre">pytest_</span></code> prefix
naming convention, making them easy to distinguish and find.</p>
</div></div>
<section id="pluginorder">
<span id="id2"></span><h2>工具启动时插件发现顺序<a class="headerlink" href="#pluginorder" title="Link to this heading">¶</a></h2>
<p><strong>Plugin discovery order at tool startup</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> 在工具启动时通过以下方式加载插件模块：</p>
<ol class="arabic simple">
<li><p>扫描命令行中的 <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">no:name</span></code> 选项，并*阻止*该插件的加载（即使是内置插件也可以通过这种方式阻止加载）。此过程在正常的命令行解析之前执行。</p></li>
<li><p>加载所有内置插件。</p></li>
<li><p>扫描命令行中的 <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">name</span></code> 选项并加载指定插件。此过程在正常的命令行解析之前执行。</p></li>
<li><p>加载通过安装的第三方包中的 <a class="reference internal" href="#pip-installable-plugins"><span class="std std-ref">入口点</span></a> 注册的所有插件，除非设置了 <span class="target" id="index-0"></span><a class="reference internal" href="../reference/reference.html#envvar-6"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTEST_DISABLE_PLUGIN_AUTOLOAD</span></code></a> 环境变量。</p></li>
<li><p>加载通过 <span class="target" id="index-1"></span><a class="reference internal" href="../reference/reference.html#envvar-7"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTEST_PLUGINS</span></code></a> 环境变量指定的所有插件。</p></li>
<li><p>加载所有“初始” <code class="file docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件：</p></li>
</ol>
<ul class="simple">
<li><p>确定测试路径：在命令行中指定的路径，否则使用 <a class="reference internal" href="../reference/reference.html#confval-35"><code class="xref std std-confval docutils literal notranslate"><span class="pre">testpaths</span></code></a> （如果在 rootdir 中定义并运行），否则为当前目录。</p></li>
<li><p>对于每个测试路径，加载相对于测试路径的目录部分的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 和 <code class="docutils literal notranslate"><span class="pre">test*/conftest.py</span></code> （如果存在）。
在加载某个 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件之前，先加载其所有父目录中的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件。加载完某个 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件后，递归加载其中 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 变量中指定的所有插件（如果存在）。</p></li>
</ul>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> loads plugin modules at tool startup in the following way:</p>
<ol class="arabic simple">
<li><p>by scanning the command line for the <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">no:name</span></code> option and <em>blocking</em> that plugin from being loaded (even builtin plugins can be blocked this way). This happens before normal command-line parsing.</p></li>
</ol>
<ol class="arabic simple">
<li><p>by loading all builtin plugins.</p></li>
<li><p>by scanning the command line for the <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">name</span></code> option and loading the specified plugin. This happens before normal command-line parsing.</p></li>
</ol>
<ol class="arabic simple">
<li><p>by loading all plugins registered through installed third-party package <a class="reference internal" href="#pip-installable-plugins"><span class="std std-ref">entry points</span></a>, unless the <span class="target" id="index-2"></span><a class="reference internal" href="../reference/reference.html#envvar-6"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTEST_DISABLE_PLUGIN_AUTOLOAD</span></code></a> environment variable is set.</p></li>
</ol>
<ol class="arabic simple">
<li><p>by loading all plugins specified through the <span class="target" id="index-3"></span><a class="reference internal" href="../reference/reference.html#envvar-7"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTEST_PLUGINS</span></code></a> environment variable.</p></li>
<li><p>by loading all “initial “<code class="file docutils literal notranslate"><span class="pre">conftest.py</span></code> files:</p></li>
</ol>
<ul class="simple">
<li><p>determine the test paths: specified on the command line, otherwise in <a class="reference internal" href="../reference/reference.html#confval-35"><code class="xref std std-confval docutils literal notranslate"><span class="pre">testpaths</span></code></a> if defined and running from the rootdir, otherwise the current dir</p></li>
<li><dl class="simple">
<dt>for each test path, load <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> and <code class="docutils literal notranslate"><span class="pre">test*/conftest.py</span></code> relative to the directory part of the test path, if exist. Before a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file is loaded, load <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files in all of its parent directories.</dt><dd><p>After a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file is loaded, recursively load all plugins specified in its <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> variable if present.</p>
</dd>
</dl>
</li>
</ul>
</div></div>
</section>
<section id="local-conftest-plugins">
<span id="localplugin"></span><span id="conftest-py-plugins"></span><span id="id3"></span><h2>conftest.py: 本地每个目录插件<a class="headerlink" href="#local-conftest-plugins" title="Link to this heading">¶</a></h2>
<p><strong>conftest.py: local per-directory plugins</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><p>本地 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 插件包含特定于目录的钩子实现。会话和测试运行活动将调用文件系统根目录附近的所有 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中定义的钩子。以下示例展示了如何实现 <code class="docutils literal notranslate"><span class="pre">pytest_runtest_setup</span></code> 钩子，使其仅在 <code class="docutils literal notranslate"><span class="pre">a</span></code> 子目录中的测试运行时被调用，而不适用于其他目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">/</span><span class="n">conftest</span><span class="o">.</span><span class="n">py</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">pytest_runtest_setup</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="c1"># called for running each test in &#39;a&#39; directory</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;setting up&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<span class="n">a</span><span class="o">/</span><span class="n">test_sub</span><span class="o">.</span><span class="n">py</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_sub</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="n">test_flat</span><span class="o">.</span><span class="n">py</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_flat</span><span class="p">():</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>可以这样运行它:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">test_flat</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">capture</span><span class="o">=</span><span class="n">no</span>  <span class="c1"># 不会显示 &quot;setting up&quot;</span>
<span class="n">pytest</span> <span class="n">a</span><span class="o">/</span><span class="n">test_sub</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">capture</span><span class="o">=</span><span class="n">no</span>  <span class="c1"># 会显示 &quot;setting up&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果您的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件不位于 Python 包目录中（即包含 <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> 的目录），那么 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">conftest</span></code> 可能会出现歧义，因为您的 <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> 或 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中可能还存在其他 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件。因此，建议项目将 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件放在包作用域中，或者从不在 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中导入任何内容。</p>
<p>参见： <a class="reference internal" href="../explanation/pythonpath.html#pythonpath"><span class="std std-ref">pytest 导入机制和 sys.path / PYTHONPATH</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>由于 pytest 在启动时的插件发现机制，某些钩子无法在非 <a class="reference internal" href="#pluginorder"><span class="std std-ref">initial</span></a> 的 conftest.py 文件中实现。具体细节请参阅每个钩子的文档。</p>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><p>Local <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> plugins contain directory-specific hook
implementations.  Hook Session and test running activities will
invoke all hooks defined in <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files closer to the
root of the filesystem.  Example of implementing the
<code class="docutils literal notranslate"><span class="pre">pytest_runtest_setup</span></code> hook so that is called for tests in the <code class="docutils literal notranslate"><span class="pre">a</span></code>
sub directory but not for other directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">/</span><span class="n">conftest</span><span class="o">.</span><span class="n">py</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">pytest_runtest_setup</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="c1"># called for running each test in &#39;a&#39; directory</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;setting up&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<span class="n">a</span><span class="o">/</span><span class="n">test_sub</span><span class="o">.</span><span class="n">py</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_sub</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="n">test_flat</span><span class="o">.</span><span class="n">py</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_flat</span><span class="p">():</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Here is how you might run it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="n">test_flat</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">capture</span><span class="o">=</span><span class="n">no</span>  <span class="c1"># will not show &quot;setting up&quot;</span>
<span class="n">pytest</span> <span class="n">a</span><span class="o">/</span><span class="n">test_sub</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">capture</span><span class="o">=</span><span class="n">no</span>  <span class="c1"># will show &quot;setting up&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files which do not reside in a
python package directory (i.e. one containing an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>) then
“import conftest” can be ambiguous because there might be other
<code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files as well on your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> or <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>.
It is thus good practice for projects to either put <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>
under a package scope or to never import anything from a
<code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file.</p>
<p>See also: <a class="reference internal" href="../explanation/pythonpath.html#pythonpath"><span class="std std-ref">pytest 导入机制和 sys.path / PYTHONPATH</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some hooks cannot be implemented in conftest.py files which are not
<a class="reference internal" href="#pluginorder"><span class="std std-ref">initial</span></a> due to how pytest discovers plugins during
startup. See the documentation of each hook for details.</p>
</div>
</div></div>
</section>
<section id="id4">
<h2>编写您自己的插件<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p><strong>Writing your own plugin</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><p>如果您想编写一个插件，可以从以下多个实际示例中进行参考：</p>
<ul class="simple">
<li><p>自定义收集示例插件：<a class="reference internal" href="../example/nonpython.html#yaml-plugin"><span class="std std-ref">在 Yaml 文件中指定测试的基本示例</span></a></p></li>
<li><p>提供 pytest 自身功能的内置插件</p></li>
<li><p>许多提供额外功能的 <a class="reference internal" href="../reference/plugin_list.html#plugin-list"><span class="std std-ref">外部插件</span></a></p></li>
</ul>
<p>以上插件均通过实现 <a class="reference internal" href="../reference/reference.html#hook-reference"><span class="std std-ref">hooks</span></a> 和/或 <a class="reference internal" href="../reference/fixtures.html#fixture"><span class="std std-ref">fixtures</span></a> 来扩展和增强功能。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>强烈建议查看出色的 <a class="reference external" href="https://github.com/pytest-dev/cookiecutter-pytest-plugin">cookiecutter-pytest-plugin</a> 项目，这是用于编写插件的 <a class="reference external" href="https://github.com/audreyr/cookiecutter">cookiecutter 模板</a> 。</p>
<p>此模板提供了一个出色的起点，包括一个工作插件、tox 运行的测试、详尽的 README 文件以及预配置的入口点。</p>
</div>
<p>一旦您的插件除您自己外也拥有了一些满意的用户，请考虑将插件 <a class="reference internal" href="../contributing.html#submitplugin"><span class="std std-ref">贡献给 pytest-dev</span></a>。</p>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><p>If you want to write a plugin, there are many real-life examples
you can copy from:</p>
<ul class="simple">
<li><p>a custom collection example plugin: <a class="reference internal" href="../example/nonpython.html#yaml-plugin"><span class="std std-ref">在 Yaml 文件中指定测试的基本示例</span></a></p></li>
<li><p>builtin plugins which provide pytest’s own functionality</p></li>
<li><p>many <a class="reference internal" href="../reference/plugin_list.html#plugin-list"><span class="std std-ref">external plugins</span></a> providing additional features</p></li>
</ul>
<p>All of these plugins implement <a class="reference internal" href="../reference/reference.html#hook-reference"><span class="std std-ref">hooks</span></a> and/or <a class="reference internal" href="../reference/fixtures.html#fixture"><span class="std std-ref">fixtures</span></a>
to extend and add functionality.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to check out the excellent
<a class="reference external" href="https://github.com/pytest-dev/cookiecutter-pytest-plugin">cookiecutter-pytest-plugin</a>
project, which is a <a class="reference external" href="https://github.com/audreyr/cookiecutter">cookiecutter template</a>
for authoring plugins.</p>
<p>The template provides an excellent starting point with a working plugin,
tests running with tox, a comprehensive README file as well as a
pre-configured entry-point.</p>
</div>
<p>Also consider <a class="reference internal" href="../contributing.html#submitplugin"><span class="std std-ref">contributing your plugin to pytest-dev</span></a>
once it has some happy users other than yourself.</p>
</div></div>
</section>
<section id="pip-installable-plugins">
<span id="setuptools-entry-points"></span><span id="id6"></span><h2>使其他人可以安装您的插件<a class="headerlink" href="#pip-installable-plugins" title="Link to this heading">¶</a></h2>
<p><strong>Making your plugin installable by others</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-4-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-4-4-0" name="4-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-4-4-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-4-4-1" name="4-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-4-4-0" class="sphinx-tabs-panel" id="panel-4-4-0" name="4-0" role="tabpanel" tabindex="0"><p>如果您想让您的插件对外可用，可以为您的分发定义一个所谓的入口点，这样 <code class="docutils literal notranslate"><span class="pre">pytest</span></code> 就可以找到您的插件模块。入口点是 <a class="reference external" href="https://packaging.python.org/en/latest/specifications/entry-points/" title="(in Python Packaging User Guide)"><span class="xref std std-doc">打包工具</span></a> 提供的一个特性。</p>
<p>pytest 会查找 <code class="docutils literal notranslate"><span class="pre">pytest11</span></code> 入口点以发现其插件，因此可以在 <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> 文件中定义您的插件来使其可用。</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 示例 ./pyproject.toml 文件</span>
<span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;hatchling&quot;</span><span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hatchling.build&quot;</span>

<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;myproject&quot;</span>
<span class="n">classifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;Framework :: Pytest&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">[project.entry-points.pytest11]</span>
<span class="n">myproject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;myproject.pluginmodule&quot;</span>
</pre></div>
</div>
<p>如果一个包以这种方式安装， <code class="docutils literal notranslate"><span class="pre">pytest</span></code> 会将 <code class="docutils literal notranslate"><span class="pre">myproject.pluginmodule</span></code> 作为插件加载，后者可以定义 <a class="reference internal" href="../reference/reference.html#hook-reference"><span class="std std-ref">hooks</span></a> 。使用 <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--trace-config</span></code> 确认注册。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>请确保在 <a class="reference external" href="https://pypi.org/classifiers/">PyPI 分类</a> 列表中包括 <code class="docutils literal notranslate"><span class="pre">Framework</span> <span class="pre">::</span> <span class="pre">Pytest</span></code> ，这样便于用户找到您的插件。</p>
</div>
</div><div aria-labelledby="tab-4-4-1" class="sphinx-tabs-panel" hidden="true" id="panel-4-4-1" name="4-1" role="tabpanel" tabindex="0"><p>If you want to make your plugin externally available, you
may define a so-called entry point for your distribution so
that <code class="docutils literal notranslate"><span class="pre">pytest</span></code> finds your plugin module. Entry points are
a feature that is provided by <a class="reference external" href="https://packaging.python.org/en/latest/specifications/entry-points/" title="(in Python Packaging User Guide)"><span class="xref std std-doc">packaging tools</span></a>.</p>
<p>pytest looks up the <code class="docutils literal notranslate"><span class="pre">pytest11</span></code> entrypoint to discover its
plugins, thus you can make your plugin available by defining
it in your <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample ./pyproject.toml file</span>
<span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;hatchling&quot;</span><span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hatchling.build&quot;</span>

<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;myproject&quot;</span>
<span class="n">classifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;Framework :: Pytest&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">[project.entry-points.pytest11]</span>
<span class="n">myproject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;myproject.pluginmodule&quot;</span>
</pre></div>
</div>
<p>If a package is installed this way, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> will load
<code class="docutils literal notranslate"><span class="pre">myproject.pluginmodule</span></code> as a plugin which can define
<a class="reference internal" href="../reference/reference.html#hook-reference"><span class="std std-ref">hooks</span></a>. Confirm registration with <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--trace-config</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure to include <code class="docutils literal notranslate"><span class="pre">Framework</span> <span class="pre">::</span> <span class="pre">Pytest</span></code> in your list of
<a class="reference external" href="https://pypi.org/classifiers/">PyPI classifiers</a>
to make it easy for users to find your plugin.</p>
</div>
</div></div>
</section>
<section id="assertion-rewriting">
<span id="id7"></span><h2>断言重写<a class="headerlink" href="#assertion-rewriting" title="Link to this heading">¶</a></h2>
<p><strong>Assertion Rewriting</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-5-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-5-5-0" name="5-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-5-5-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-5-5-1" name="5-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-5-5-0" class="sphinx-tabs-panel" id="panel-5-5-0" name="5-0" role="tabpanel" tabindex="0"><p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> 的主要功能之一是使用简单的 assert 语句，并在断言失败时提供详细的表达式检查。这通过“断言重写”来实现，该功能在代码被编译为字节码之前修改解析的 AST。这是通过 <span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0302/"><strong>PEP 302</strong></a> 导入钩子实现的，在 <code class="docutils literal notranslate"><span class="pre">pytest</span></code> 启动时会尽早安装该钩子，并在模块被导入时执行此重写。然而，为了确保测试和生产环境中运行的字节码一致，此钩子仅重写测试模块本身（由 <a class="reference internal" href="../reference/reference.html#confval-31"><code class="xref std std-confval docutils literal notranslate"><span class="pre">python_files</span></code></a> 配置选项定义）和任何插件中的模块。其他被导入的模块不会被重写，而会保持普通的断言行为。</p>
<p>如果您在其他模块中有需要启用断言重写的辅助断言功能，您需要明确要求 <code class="docutils literal notranslate"><span class="pre">pytest</span></code> 在导入该模块之前对其进行重写。</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">register_assert_rewrite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">names</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/_pytest/assertion.html#register_assert_rewrite"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Register one or more module names to be rewritten on import.</p>
<p>This function will make sure that this module or all modules inside
the package will get their assert statements rewritten.
Thus you should make sure to call this before the module is
actually imported, usually in your __init__.py if you are a plugin
using a package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>names</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The module names to register.</p>
</dd>
</dl>
</dd></dl>

<p>当您编写一个通过包创建的 pytest 插件时，这尤其重要。导入钩子只会将 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件和 <code class="docutils literal notranslate"><span class="pre">pytest11</span></code> 入口点中列出的模块视为插件。以下是一个示例包结构:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest_foo</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">pytest_foo</span><span class="o">/</span><span class="n">plugin</span><span class="o">.</span><span class="n">py</span>
<span class="n">pytest_foo</span><span class="o">/</span><span class="n">helper</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>以下是 <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> 的典型示例代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pytest11&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo = pytest_foo.plugin&quot;</span><span class="p">]},</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>在这种情况下，只有 <code class="docutils literal notranslate"><span class="pre">pytest_foo/plugin.py</span></code> 会被重写。如果辅助模块也包含需要重写的 assert 语句，则在导入之前需要将其标记为可重写。最简单的方法是在 <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> 模块中标记它，当导入包中的模块时，该模块总是会首先被导入。这样，<code class="docutils literal notranslate"><span class="pre">plugin.py</span></code> 仍然可以正常导入 <code class="docutils literal notranslate"><span class="pre">helper.py</span></code>。此时，<code class="docutils literal notranslate"><span class="pre">pytest_foo/__init__.py</span></code> 的内容应如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">pytest</span><span class="o">.</span><span class="n">register_assert_rewrite</span><span class="p">(</span><span class="s2">&quot;pytest_foo.helper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-5-1" class="sphinx-tabs-panel" hidden="true" id="panel-5-5-1" name="5-1" role="tabpanel" tabindex="0"><p>One of the main features of <code class="docutils literal notranslate"><span class="pre">pytest</span></code> is the use of plain assert
statements and the detailed introspection of expressions upon
assertion failures.  This is provided by “assertion rewriting” which
modifies the parsed AST before it gets compiled to bytecode.  This is
done via a <span class="target" id="index-5"></span><a class="pep reference external" href="https://peps.python.org/pep-0302/"><strong>PEP 302</strong></a> import hook which gets installed early on when
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> starts up and will perform this rewriting when modules get
imported.  However, since we do not want to test different bytecode
from what you will run in production, this hook only rewrites test modules
themselves (as defined by the <a class="reference internal" href="../reference/reference.html#confval-31"><code class="xref std std-confval docutils literal notranslate"><span class="pre">python_files</span></code></a> configuration option),
and any modules which are part of plugins.
Any other imported module will not be rewritten and normal assertion behaviour
will happen.</p>
<p>If you have assertion helpers in other modules where you would need
assertion rewriting to be enabled you need to ask <code class="docutils literal notranslate"><span class="pre">pytest</span></code>
explicitly to rewrite this module before it gets imported.</p>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">register_assert_rewrite</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">names</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/_pytest/assertion.html#register_assert_rewrite"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Register one or more module names to be rewritten on import.</p>
<p>This function will make sure that this module or all modules inside
the package will get their assert statements rewritten.
Thus you should make sure to call this before the module is
actually imported, usually in your __init__.py if you are a plugin
using a package.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>names</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The module names to register.</p>
</dd>
</dl>
</dd></dl>

<p>This is especially important when you write a pytest plugin which is
created using a package.  The import hook only treats <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>
files and any modules which are listed in the <code class="docutils literal notranslate"><span class="pre">pytest11</span></code> entrypoint
as plugins.  As an example consider the following package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest_foo</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">pytest_foo</span><span class="o">/</span><span class="n">plugin</span><span class="o">.</span><span class="n">py</span>
<span class="n">pytest_foo</span><span class="o">/</span><span class="n">helper</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>With the following typical <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> extract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pytest11&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo = pytest_foo.plugin&quot;</span><span class="p">]},</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case only <code class="docutils literal notranslate"><span class="pre">pytest_foo/plugin.py</span></code> will be rewritten.  If the
helper module also contains assert statements which need to be
rewritten it needs to be marked as such, before it gets imported.
This is easiest by marking it for rewriting inside the
<code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module, which will always be imported first when a
module inside a package is imported.  This way <code class="docutils literal notranslate"><span class="pre">plugin.py</span></code> can still
import <code class="docutils literal notranslate"><span class="pre">helper.py</span></code> normally.  The contents of
<code class="docutils literal notranslate"><span class="pre">pytest_foo/__init__.py</span></code> will then need to look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">pytest</span><span class="o">.</span><span class="n">register_assert_rewrite</span><span class="p">(</span><span class="s2">&quot;pytest_foo.helper&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="id8">
<h2>在测试模块或 conftest 文件中要求/加载插件<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h2>
<p><strong>Requiring/Loading plugins in a test module or conftest file</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-6-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-6-6-0" name="6-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-6-6-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-6-6-1" name="6-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-6-6-0" class="sphinx-tabs-panel" id="panel-6-6-0" name="6-0" role="tabpanel" tabindex="0"><p>您可以在测试模块或 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中使用 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 来要求插件：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytest_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name1&quot;</span><span class="p">,</span> <span class="s2">&quot;name2&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>当加载测试模块或 conftest 插件时，指定的插件也将被加载。任何模块都可以被标记为插件，包括内部应用程序模块：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytest_plugins</span> <span class="o">=</span> <span class="s2">&quot;myapp.testsupport.myplugin&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 会递归处理，因此请注意，在上面的示例中，如果 <code class="docutils literal notranslate"><span class="pre">myapp.testsupport.myplugin</span></code> 也声明了 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a>，则该变量的内容也将被作为插件加载，依此类推。</p>
<div class="admonition note" id="requiring-plugins-in-non-root-conftests">
<p class="admonition-title">Note</p>
<p>在非根 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中使用 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 变量要求插件已被弃用。</p>
<p>这很重要，因为 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件实现了每个目录的钩子实现，但一旦导入了插件，它将影响整个目录树。为了避免混淆，在不位于测试根目录的任何 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中定义 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 已被弃用，并会发出警告。</p>
</div>
<p>此机制使在应用程序或甚至外部应用程序中共享 fixtures 变得简单，而无需使用 <a class="reference external" href="https://packaging.python.org/en/latest/guides/creating-and-discovering-plugins/" title="(in Python Packaging User Guide)"><span class="xref std std-doc">entry point packaging metadata</span></a> 技术创建外部插件。</p>
<p>通过 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 导入的插件也会自动标记为断言重写（见 <a class="reference internal" href="../reference/reference.html#pytest.register_assert_rewrite" title="pytest.register_assert_rewrite"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.register_assert_rewrite()</span></code></a>）。但是，为了使其生效，模块必须尚未被导入；如果在处理 <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> 语句时该模块已经被导入，将会产生警告，插件中的断言将不会被重写。要解决此问题，您可以在导入模块之前自己调用 <a class="reference internal" href="../reference/reference.html#pytest.register_assert_rewrite" title="pytest.register_assert_rewrite"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.register_assert_rewrite()</span></code></a>，或者可以安排代码以延迟导入，直到插件注册之后。</p>
</div><div aria-labelledby="tab-6-6-1" class="sphinx-tabs-panel" hidden="true" id="panel-6-6-1" name="6-1" role="tabpanel" tabindex="0"><p>You can require plugins in a test module or a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file using <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytest_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name1&quot;</span><span class="p">,</span> <span class="s2">&quot;name2&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>When the test module or conftest plugin is loaded the specified plugins
will be loaded as well. Any module can be blessed as a plugin, including internal
application modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytest_plugins</span> <span class="o">=</span> <span class="s2">&quot;myapp.testsupport.myplugin&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> are processed recursively, so note that in the example above
if <code class="docutils literal notranslate"><span class="pre">myapp.testsupport.myplugin</span></code> also declares <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a>, the contents
of the variable will also be loaded as plugins, and so on.</p>
<div class="admonition note" id="id9">
<p class="admonition-title">Note</p>
<p>Requiring plugins using <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> variable in non-root
<code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files is deprecated.</p>
<p>This is important because <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files implement per-directory
hook implementations, but once a plugin is imported, it will affect the
entire directory tree. In order to avoid confusion, defining
<a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> in any <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file which is not located in the
tests root directory is deprecated, and will raise a warning.</p>
</div>
<p>This mechanism makes it easy to share fixtures within applications or even
external applications without the need to create external plugins using the
<a class="reference external" href="https://packaging.python.org/en/latest/guides/creating-and-discovering-plugins/" title="(in Python Packaging User Guide)"><span class="xref std std-doc">entry point packaging metadata</span></a> technique.</p>
<p>Plugins imported by <a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> will also automatically be marked
for assertion rewriting (see <a class="reference internal" href="../reference/reference.html#pytest.register_assert_rewrite" title="pytest.register_assert_rewrite"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.register_assert_rewrite()</span></code></a>).
However for this to have any effect the module must not be
imported already; if it was already imported at the time the
<a class="reference internal" href="../reference/reference.html#globalvar-2"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytest_plugins</span></code></a> statement is processed, a warning will result and
assertions inside the plugin will not be rewritten.  To fix this you
can either call <a class="reference internal" href="../reference/reference.html#pytest.register_assert_rewrite" title="pytest.register_assert_rewrite"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.register_assert_rewrite()</span></code></a> yourself before
the module is imported, or you can arrange the code to delay the
importing until after the plugin is registered.</p>
</div></div>
</section>
<section id="id10">
<h2>通过名称访问另一个插件<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h2>
<p><strong>Accessing another plugin by name</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-7-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-7-7-0" name="7-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-7-7-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-7-7-1" name="7-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-7-7-0" class="sphinx-tabs-panel" id="panel-7-7-0" name="7-0" role="tabpanel" tabindex="0"><p>如果一个插件想要与另一个插件的代码协作，它可以通过插件管理器获得引用，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugin</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="s2">&quot;name_of_plugin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果您想查看现有插件的名称，请使用 <code class="docutils literal notranslate"><span class="pre">--trace-config</span></code> 选项。</p>
</div><div aria-labelledby="tab-7-7-1" class="sphinx-tabs-panel" hidden="true" id="panel-7-7-1" name="7-1" role="tabpanel" tabindex="0"><p>If a plugin wants to collaborate with code from
another plugin it can obtain a reference through
the plugin manager like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugin</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="s2">&quot;name_of_plugin&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to look at the names of existing plugins, use
the <code class="docutils literal notranslate"><span class="pre">--trace-config</span></code> option.</p>
</div></div>
</section>
<section id="registering-markers">
<span id="id11"></span><h2>注册自定义标记<a class="headerlink" href="#registering-markers" title="Link to this heading">¶</a></h2>
<p><strong>Registering custom markers</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-8-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-8-8-0" name="8-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-8-8-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-8-8-1" name="8-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-8-8-0" class="sphinx-tabs-panel" id="panel-8-8-0" name="8-0" role="tabpanel" tabindex="0"><p>如果您的插件使用了任何标记，您应该注册它们，以便它们出现在 pytest 的帮助文本中，并且不会 <a class="reference internal" href="mark.html#unknown-marks"><span class="std std-ref">导致虚假警告</span></a>。
例如，以下插件将为所有用户注册 <code class="docutils literal notranslate"><span class="pre">cool_marker</span></code> 和 <code class="docutils literal notranslate"><span class="pre">mark_with</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pytest_configure</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span> <span class="s2">&quot;cool_marker: this one is for cool tests.&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span>
        <span class="s2">&quot;markers&quot;</span><span class="p">,</span> <span class="s2">&quot;mark_with(arg, arg2): this marker takes arguments.&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-8-1" class="sphinx-tabs-panel" hidden="true" id="panel-8-8-1" name="8-1" role="tabpanel" tabindex="0"><p>If your plugin uses any markers, you should register them so that they appear in
pytest’s help text and do not <a class="reference internal" href="mark.html#unknown-marks"><span class="std std-ref">cause spurious warnings</span></a>.
For example, the following plugin would register <code class="docutils literal notranslate"><span class="pre">cool_marker</span></code> and
<code class="docutils literal notranslate"><span class="pre">mark_with</span></code> for all users:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pytest_configure</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span> <span class="s2">&quot;cool_marker: this one is for cool tests.&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span>
        <span class="s2">&quot;markers&quot;</span><span class="p">,</span> <span class="s2">&quot;mark_with(arg, arg2): this marker takes arguments.&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="id12">
<h2>测试插件<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h2>
<p><strong>Testing plugins</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-9-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-9-9-0" name="9-0" role="tab" tabindex="0">中文</button><button aria-controls="panel-9-9-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-9-9-1" name="9-1" role="tab" tabindex="-1">英文</button></div><div aria-labelledby="tab-9-9-0" class="sphinx-tabs-panel" id="panel-9-9-0" name="9-0" role="tabpanel" tabindex="0"><p>pytest 附带一个名为 <code class="docutils literal notranslate"><span class="pre">pytester</span></code> 的插件，帮助您为插件代码编写测试。该插件默认情况下是禁用的，因此在使用之前需要先启用它。</p>
<p>您可以通过在测试目录中的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件中添加以下行来做到这一点：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of conftest.py</span>

<span class="n">pytest_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pytester&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>或者，您可以使用 <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">pytester</span></code> 命令行选项调用 pytest。</p>
<p>这将允许您使用 <a class="reference internal" href="../reference/reference.html#id11" title="pytest.Pytester"><code class="xref py py-class docutils literal notranslate"><span class="pre">pytester</span></code></a> 夹具来测试您的插件代码。</p>
<p>让我们用一个示例演示您可以使用该插件做什么。假设我们开发了一个提供 <code class="docutils literal notranslate"><span class="pre">hello</span></code> 夹具的插件，该夹具返回一个函数，我们可以用一个可选参数调用此函数。如果不提供值，它将返回字符串 <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code>；如果提供了字符串值，则返回 <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">{value}!</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">pytest_addoption</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">getgroup</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">addoption</span><span class="p">(</span>
        <span class="s2">&quot;--name&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;World&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Default &quot;name&quot; for hello().&#39;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>

    <span class="k">return</span> <span class="n">_hello</span>
</pre></div>
</div>
<p>现在，<code class="docutils literal notranslate"><span class="pre">pytester</span></code> 夹具提供了一个方便的 API，用于创建临时的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件和测试文件。它还允许我们运行测试并返回结果对象，通过该对象我们可以断言测试的结果。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">pytester</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;确保我们的插件正常工作。&quot;&quot;&quot;</span>

    <span class="c1"># 创建一个临时 conftest.py 文件</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">makeconftest</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        import pytest</span>

<span class="sd">        @pytest.fixture(params=[</span>
<span class="sd">            &quot;Brianna&quot;,</span>
<span class="sd">            &quot;Andreas&quot;,</span>
<span class="sd">            &quot;Floris&quot;,</span>
<span class="sd">        ])</span>
<span class="sd">        def name(request):</span>
<span class="sd">            return request.param</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># 创建一个临时 pytest 测试文件</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">makepyfile</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        def test_hello_default(hello):</span>
<span class="sd">            assert hello() == &quot;Hello World!&quot;</span>

<span class="sd">        def test_hello_name(hello, name):</span>
<span class="sd">            assert hello(name) == &quot;Hello {0}!&quot;.format(name)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># 使用 pytest 运行所有测试</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pytester</span><span class="o">.</span><span class="n">runpytest</span><span class="p">()</span>

    <span class="c1"># 检查所有 4 个测试是否通过</span>
    <span class="n">result</span><span class="o">.</span><span class="n">assert_outcomes</span><span class="p">(</span><span class="n">passed</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>此外，在运行 pytest 之前，还可以将示例复制到 <code class="docutils literal notranslate"><span class="pre">pytester</span></code> 的隔离环境中。这样，我们可以将测试逻辑抽象到单独的文件中，这对于较长的测试和/或较长的 <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> 文件尤其有用。</p>
<p>请注意，要使 <code class="docutils literal notranslate"><span class="pre">pytester.copy_example</span></code> 工作，我们需要在 <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> 中设置 <code class="docutils literal notranslate"><span class="pre">pytester_example_dir</span></code>，以告知 pytest 在哪里查找示例文件。</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">pytester_example_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test_example.py</span>


<span class="k">def</span> <span class="nf">test_plugin</span><span class="p">(</span><span class="n">pytester</span><span class="p">):</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">copy_example</span><span class="p">(</span><span class="s2">&quot;test_example.py&quot;</span><span class="p">)</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">runpytest</span><span class="p">(</span><span class="s2">&quot;-k&quot;</span><span class="p">,</span> <span class="s2">&quot;test_example&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_example</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest
<span class=" -Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-8.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
configfile: pytest.ini
collected 2 items

test_example.py <span class=" -Color -Color-Green">..</span>                                                   <span class=" -Color -Color-Green">[100%]</span>

<span class=" -Color -Color-Green">============================ </span><span class=" -Color -Color-Bold -Color-Bold-Green">2 passed</span><span class=" -Color -Color-Green"> in 0.12s =============================</span>
</pre></div>
</div>
<p>有关 <code class="docutils literal notranslate"><span class="pre">runpytest()</span></code> 返回的结果对象以及它提供的方法的更多信息，请查看 <a class="reference internal" href="../reference/reference.html#id50" title="_pytest.pytester.RunResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunResult</span></code></a> 文档。</p>
</div><div aria-labelledby="tab-9-9-1" class="sphinx-tabs-panel" hidden="true" id="panel-9-9-1" name="9-1" role="tabpanel" tabindex="0"><p>pytest comes with a plugin named <code class="docutils literal notranslate"><span class="pre">pytester</span></code> that helps you write tests for
your plugin code. The plugin is disabled by default, so you will have to enable
it before you can use it.</p>
<p>You can do so by adding the following line to a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file in your
testing directory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of conftest.py</span>

<span class="n">pytest_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pytester&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Alternatively you can invoke pytest with the <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">pytester</span></code> command line
option.</p>
<p>This will allow you to use the <a class="reference internal" href="../reference/reference.html#id11" title="pytest.Pytester"><code class="xref py py-class docutils literal notranslate"><span class="pre">pytester</span></code></a>
fixture for testing your plugin code.</p>
<p>Let’s demonstrate what you can do with the plugin with an example. Imagine we
developed a plugin that provides a fixture <code class="docutils literal notranslate"><span class="pre">hello</span></code> which yields a function
and we can invoke this function with one optional parameter. It will return a
string value of <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World!</span></code> if we do not supply a value or <code class="docutils literal notranslate"><span class="pre">Hello</span>
<span class="pre">{value}!</span></code> if we do supply a string value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">pytest_addoption</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">getgroup</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">addoption</span><span class="p">(</span>
        <span class="s2">&quot;--name&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;World&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Default &quot;name&quot; for hello().&#39;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>

    <span class="k">return</span> <span class="n">_hello</span>
</pre></div>
</div>
<p>Now the <code class="docutils literal notranslate"><span class="pre">pytester</span></code> fixture provides a convenient API for creating temporary
<code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files and test files. It also allows us to run the tests and
return a result object, with which we can assert the tests’ outcomes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">pytester</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make sure that our plugin works.&quot;&quot;&quot;</span>

    <span class="c1"># create a temporary conftest.py file</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">makeconftest</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        import pytest</span>

<span class="sd">        @pytest.fixture(params=[</span>
<span class="sd">            &quot;Brianna&quot;,</span>
<span class="sd">            &quot;Andreas&quot;,</span>
<span class="sd">            &quot;Floris&quot;,</span>
<span class="sd">        ])</span>
<span class="sd">        def name(request):</span>
<span class="sd">            return request.param</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># create a temporary pytest test file</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">makepyfile</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        def test_hello_default(hello):</span>
<span class="sd">            assert hello() == &quot;Hello World!&quot;</span>

<span class="sd">        def test_hello_name(hello, name):</span>
<span class="sd">            assert hello(name) == &quot;Hello {0}!&quot;.format(name)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># run all tests with pytest</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pytester</span><span class="o">.</span><span class="n">runpytest</span><span class="p">()</span>

    <span class="c1"># check that all 4 tests passed</span>
    <span class="n">result</span><span class="o">.</span><span class="n">assert_outcomes</span><span class="p">(</span><span class="n">passed</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally it is possible to copy examples to the <code class="docutils literal notranslate"><span class="pre">pytester</span></code>’s isolated environment
before running pytest on it. This way we can abstract the tested logic to separate files,
which is especially useful for longer tests and/or longer <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files.</p>
<p>Note that for <code class="docutils literal notranslate"><span class="pre">pytester.copy_example</span></code> to work we need to set <code class="docutils literal notranslate"><span class="pre">pytester_example_dir</span></code>
in our <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> to tell pytest where to look for example files.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">pytester_example_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test_example.py</span>


<span class="k">def</span> <span class="nf">test_plugin</span><span class="p">(</span><span class="n">pytester</span><span class="p">):</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">copy_example</span><span class="p">(</span><span class="s2">&quot;test_example.py&quot;</span><span class="p">)</span>
    <span class="n">pytester</span><span class="o">.</span><span class="n">runpytest</span><span class="p">(</span><span class="s2">&quot;-k&quot;</span><span class="p">,</span> <span class="s2">&quot;test_example&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_example</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest
<span class=" -Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-8.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
configfile: pytest.ini
collected 2 items

test_example.py <span class=" -Color -Color-Green">..</span>                                                   <span class=" -Color -Color-Green">[100%]</span>

<span class=" -Color -Color-Green">============================ </span><span class=" -Color -Color-Bold -Color-Bold-Green">2 passed</span><span class=" -Color -Color-Green"> in 0.12s =============================</span>
</pre></div>
</div>
<p>For more information about the result object that <code class="docutils literal notranslate"><span class="pre">runpytest()</span></code> returns, and
the methods that it provides please check out the <a class="reference internal" href="../reference/reference.html#id50" title="_pytest.pytester.RunResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunResult</span></code></a> documentation.</p>
</div></div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="writing_hook_functions.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">编写钩子函数</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="plugins.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">如何安装和使用插件</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015, holger krekel and pytest-dev team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">编写插件</a><ul>
<li><a class="reference internal" href="#pluginorder">工具启动时插件发现顺序</a></li>
<li><a class="reference internal" href="#local-conftest-plugins">conftest.py: 本地每个目录插件</a></li>
<li><a class="reference internal" href="#id4">编写您自己的插件</a></li>
<li><a class="reference internal" href="#pip-installable-plugins">使其他人可以安装您的插件</a></li>
<li><a class="reference internal" href="#assertion-rewriting">断言重写</a></li>
<li><a class="reference internal" href="#id8">在测试模块或 conftest 文件中要求/加载插件</a></li>
<li><a class="reference internal" href="#id10">通过名称访问另一个插件</a></li>
<li><a class="reference internal" href="#registering-markers">注册自定义标记</a></li>
<li><a class="reference internal" href="#id12">测试插件</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=7c91f8fd"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/tabs.js?v=3030b3cb"></script>
    </body>
</html>